let expenses = JSON.parse(localStorage.getItem("expenses") || "[]");

function display() {
    document.getElementById("list").innerHTML = expenses.map((e, i) => `
        <div class="item">
            <p>${e.title} — ₹${e.amount} — ${e.category}</p>
            <button onclick="delExpense(${i})">x</button>
        </div>
    `).join("");

    localStorage.setItem("expenses", JSON.stringify(expenses));
    updateChart();
}
function addExpense() {
    let title = document.getElementById("title").value;
    let amount = document.getElementById("amount").value;
    let category = document.getElementById("category").value;

    if (!title || !amount) return alert("Enter details");
    expenses.push({ title, amount, category });
    display();
}
function delExpense(i) {
    expenses.splice(i, 1);
    display();
}

let chart;
function updateChart() {
    const catTotals = expenses.reduce((a, b) => {
        a[b.category] = (a[b.category] || 0) + Number(b.amount);
        return a;
    }, {});

    if (chart) chart.destroy();
    chart = new Chart(document.getElementById("chart"), {
        type: "pie",
        data: {
            labels: Object.keys(catTotals),
            datasets: [{
                data: Object.values(catTotals)
            }]
        }
    });
}
display();
